<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous"><script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/serach.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true}}</script><script src="/js/config.js"></script><link rel="canonical" href="http://example.com/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/"><script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/","path":"2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/","title":"《计算机网络-自顶向下方法 第7版》第8章 多媒体网络"}</script><script class="next-config" data-name="calendar" type="application/json">""</script><title>《计算机网络-自顶向下方法 第7版》第8章 多媒体网络 |</title><noscript><link rel="stylesheet" href="/css/noscript.css"></noscript></head><body itemscope itemtype="http://schema.org/WebPage" class="use-motion"><div class="headband"></div><main class="main"><div class="column"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><i class="logo-line"></i><p class="site-title"></p><i class="logo-line"></i></a></div><div class="site-nav-right"><div class="toggle popup-trigger" aria-label="搜索" role="button"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" maxlength="80" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close" role="button"><i class="fa fa-times-circle"></i></span></div><div class="search-result-container"><div class="search-result-icon"><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></header><aside class="sidebar"><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class="sidebar-nav"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="sidebar-panel-container"><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%81%E5%BC%8F%E5%AD%98%E5%82%A8%E8%A7%86%E9%A2%91"><span class="nav-text">8.1 流式存储视频</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#udp%E6%B5%81"><span class="nav-text">8.1.1 UDP流</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#http%E6%B5%81"><span class="nav-text">8.1.2 HTTP流</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ip%E8%AF%AD%E9%9F%B3"><span class="nav-text">8.2 IP语音</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8%E6%8E%A5%E6%94%B6%E7%AB%AF%E6%B6%88%E9%99%A4%E6%97%B6%E5%BB%B6%E6%8A%96%E5%8A%A8"><span class="nav-text">8.2.1 在接收端消除时延抖动</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%A2%E5%8C%85%E6%81%A2%E5%A4%8D"><span class="nav-text">8.2.2 丢包恢复</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%88%E4%BE%8B%E5%AD%A6%E4%B9%A0skype"><span class="nav-text">8.2.3 案例学习：Skype</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E6%97%B6%E4%BC%9A%E8%AF%9D%E5%BA%94%E7%94%A8%E5%8D%8F%E8%AE%AE"><span class="nav-text">8.3 实时会话应用协议</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#rtp"><span class="nav-text">8.3.1 RTP</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sip"><span class="nav-text">8.3.2 SIP</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E5%AA%92%E4%BD%93%E7%BD%91%E7%BB%9C"><span class="nav-text">8.4 多媒体网络</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8F%90%E4%BE%9B%E5%A4%9A%E7%A7%8D%E7%B1%BB%E5%9E%8B%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="nav-text">8.4.1 提供多种类型的服务</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ds%E6%9E%B6%E6%9E%84"><span class="nav-text">8.4.2 DS架构</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name"></p><div class="site-description" itemprop="description">这只是个人学习总结，难免出错，欢迎指出，邮箱：water-music@outlook.com</div></div><div class="site-state-wrap animated"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">32</span> <span class="site-state-item-name">文章</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">3</span> <span class="site-state-item-name">分类</span></a></div></nav></div></div></div></div></aside></div><div class="main-inner post posts-expand"><div class="post-block"><article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.gif"><meta itemprop="name" content=""></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content=""><meta itemprop="description" content="这只是个人学习总结，难免出错，欢迎指出，邮箱：water-music@outlook.com"></span><span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork"><meta itemprop="name" content="《计算机网络-自顶向下方法 第7版》第8章 多媒体网络 | null"><meta itemprop="description" content=""></span><header class="post-header"><h1 class="post-title" itemprop="name headline">《计算机网络-自顶向下方法 第7版》第8章 多媒体网络</h1><div class="post-meta-container"><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2022-09-10 00:00:00" itemprop="dateCreated datePublished" datetime="2022-09-10T00:00:00+08:00">2022-09-10</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2023-03-30 00:00:00" itemprop="dateModified" datetime="2023-03-30T00:00:00+08:00">2023-03-30</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/computer-network/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a> </span></span><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="far fa-file-word"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>12k</span></span></div></div></header><div class="post-body" itemprop="articleBody"><p>　　视频最为显著的特点是<strong>高比特率</strong>，另一个重要特点是可以被压缩，从而在视频质量和比特率之间权衡。视频有两种类型的冗余，都可以用来进行<strong>视频压缩</strong>。<span style="background-color:#ff0">空间冗余</span>是给定图像的内部冗余，主要由空白组成的图像具有高度冗余，可以在不牺牲图像质量下进行冗余。<span style="background-color:#ff0">时间冗余</span>反映了图像间的重复。可以通过压缩来生成<strong>多重版本</strong>的视频，不同版本具有不同的质量等级。</p><p>　　模拟音频信号以某个固定速率进行采样，每个采样值近似取值为有限数量的值之一，该过程称为<strong>量化</strong>，这些值的数量称为<strong>量化值</strong>，通常是2的幂。每个量化值由固定数量的位表示。解码后的的信号只是原始信号的近似值，音质可能有所下降(可能丢失高频的声音)。增加采样率和量化值的数量可以让解码后的信号更接近原始信号。</p><p>　　<strong>脉冲编码调制</strong>是一种音频编码技术，语音使用的PCM采用速率是每秒8000个样本，每个样本用8位表示，因此速率是<span class="math inline">\(64Kb/s\)</span>。音频光盘使用的PCM采用速率是每秒44100个样本，每个样本用16位表示，单声道速率为<span class="math inline">\(705.6Kb/s\)</span>，立体声速率为<span class="math inline">\(1.411Mb/s\)</span>。</p><p>　　压缩也可以用于降低音频流的比特率，人类语音可以压缩到小于<span class="math inline">\(10Kb/s\)</span>且依旧可以理解。用于接近CD质量的立体声音乐的流行压缩技术是<strong>MP3</strong>(MPEG 1 layer 3)，MP3编码器可以压缩到不同的速率，<span class="math inline">\(128Kb/s\)</span>的编码速率可以保证很小的声音失真，一种相关标准是<strong>高级音频编码</strong>。</p><p>　　多媒体应用大致可以分为<span style="background-color:#ff0">流式存储音频/视频</span>、<span style="background-color:#ff0">会话式IP语音/视频</span>和<span style="background-color:#ff0">流式实况音频/视频</span>。</p><p>　　<strong>流式传输</strong>时，客户端在从服务器接收音频/视频一段时间后就可以播放，在播放的同时继续接收剩余部分，避免了在播放前需要接收整个文件。</p><p>　　● 流式存储视频依赖的媒体是服务器上预先录制的视频，用户向服务器请求以按需观看视频。流式存储视频的特点是<strong>流媒体</strong>、<strong>交互性</strong>和<strong>不间断播放</strong>。由于视频是预先录制的，用户可以进行快进等操作并获得即时响应。视频播放开始后应按照录制的时序进行，因此必须从服务器及时接收数据。流式存储音频与流式存储视频相同。</p><p>　　● 互联网上的实时会话式语音通常称为<strong>网络电话</strong>或<strong>IP语音</strong>。因为从用户的角度，它类似于传统的电话交换服务。会话式语音/视频是<span style="background-color:#ff0">时延敏感</span>但<span style="background-color:#ff0">容忍丢包</span>的。</p><p>　　● 流式实况音频/视频类似于传统的电台和电视，只是它通过互联网传输。</p><p>　　分发存储和实况视频经常使用CDN。</p><p>　　对于VOIP等会话时实时应用，重传一个错过预计播放时间的分组没有意义。</p><span id="more"></span><h3 id="流式存储视频">8.1 流式存储视频</h3><p>　　流式视频系统分为<strong>UDP流</strong>、<strong>HTTP流</strong>和<strong>自适应HTTP流</strong>。这三种形式的视频流的共同特点是广泛使用了客户端应用程序的缓存来减轻变化的的端到端时延以及变化的客户端和服务器间可用带宽的影响。这种<strong>客户端缓存</strong>不仅可以吸收服务器到客户端时延中的波动，而且当其未完全耗尽时，即使服务器到客户端的带宽暂时低于视频消耗速率，客户端也能维持不间断播放。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/client_playout_delay_in_video_streaming.svg" title="client_playout_delay_in_video_streaming"><p>　　假设视频以固定的比特率编码，因此每个视频块包含在固定时间<span class="math inline">\(\Delta\)</span>播放的视频帧。服务器在<span class="math inline">\(t_0\)</span>传输第一个视频块，在<span class="math inline">\(t_0+\Delta\)</span>传输第二个视频块，依此类推。一旦客户端开始播放，每个块应该在前一个块之后播放<span class="math inline">\(\Delta\)</span>时间单元来保证原始视频录制时的时序。若在<span class="math inline">\(t_1\)</span>就开始播放视频则第二块不能在<span class="math inline">\(t_1+\Delta\)</span>内到达，相反，若<span class="math inline">\(t_3\)</span>开始播放，此时前6块已到达，所有收到的块都能按序且不间断地播放。</p><h4 id="udp流">8.1.1 UDP流</h4><p>　　UDP流通常使用的客户端缓存较小。由于UDP没有拥塞控制，服务器能够以客户端的视频消耗速率的传输视频。在视频块传递给UDP前，服务器将视频块封装在传输分组中，该传输分组专为传输音频/视频设计，使用了<strong>实时传输协议</strong>或<strong>会话发起协议</strong>等类似的方案。RTP可用于传输常见格式和专用的音频和视频格式，它也是其他实时交互协议(如<strong>生成树协议</strong>)的补充。SIP是一个开放的轻量级协议。</p><p>　　使用UDP时，除了服务器到客户端的视频流外，客户端和服务器还同时维护一个单独的控制链接，客户端通过该连接发送有关会话状态变化的命令(如暂停、重新开始、重定位等)，<strong>实时流传输协议</strong>是一种用于这种控制连接的协议。</p><p>　　UDP存在三个重大缺陷，首先，由于服务器和客户端之间的可用带宽不可预测且不断变化，因此恒定速率UDP流不一定能保证不间断播放。其次，需要RTSP服务器这样的媒体控制服务器来为每个正在进行的客户端会话处理客户端到服务器的交互请求并跟踪客户端状态，这增加了大规模部署成本和复杂性。最后，许多防火墙配置为阻止UDP流量。</p><h4 id="http流">8.1.2 HTTP流</h4><p>　　在HTTP流中， 视频作为具有特定URL的文件存储在HTTP服务器上。当用户要观看视频时，客户端与服务器建立一个TCP连接并对该URL发起HTTP GET请求。服务器在HTTP响应报文中发送该视频文件，即以TCP拥塞控制和流控制允许的情况下尽快发送。在客户端，数据被收集在客户端应用程序缓存中。当缓存中的字节数达到阈值就开始播放，它周期性地从客户端应用程序缓存中读取视频帧，对帧解压并在用户屏幕上显示。</p><p>　　对于流式存储视频，客户端能够以高于消耗速率的速率下载视频，从而<strong>预取</strong>将被消耗的视频帧。当平均TCP吞吐量大约是媒体比特率的两倍时，TCP流达到最小的饥饿和低缓存时延。</p><p>　　由于TCP的拥塞控制机制，服务器到客户端的传输速率可能波动很大，而且分组可能由于重传机制而出现较大的时延。使用了客户端缓存和预取后，这些不一定会妨碍不间断播放。</p><p>　　HTTP基于TCP，因此更容易穿越防火墙和NAT。HTTP流无需媒体控制服务器，从而减低大规模部署的成本。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/streaming_stored_video_over_http.svg" title="streaming_stored_video_over_http"><p>　　服务器的视频文件通过套接字后，字节在传输到互联网前存放在TCP发送缓存，当服务器的TCP发送缓存已满时，服务器暂时无法将更多的字节从视频文件发送到套接字。客户端应用程序从TCP接收缓存(通过套接字)读取字节并将字节存放到客户端缓存。同时客户端应用程序周期性地从客户端缓存抓取视频帧并解压播放。若客户端缓存大于该视频文件则从客户端直接按照TCP允许的最快速率从服务器接收视频。</p><p>　　当客户端缓存变满时，可能会导致TCP接收缓存边满，进而TCP发送缓存也会变满，服务器不能向套接字中发送字节。因此，播放暂停可能服务器被迫停止传输直到继续播放。在常规的播放中，若客户端缓存变满，进而导致TCP缓存变满，迫使服务器降低发送速率，因此服务器的发送速率不能高于客户端视频消耗速率。因此，当使用HTTP流时，满的客户端缓存间接地限制了服务器到客户端的传输速率。</p><p>　　<span class="math inline">\(B(b)\)</span>表示客户端应用程序的缓存，<span class="math inline">\(Q(b)\)</span>表示客户端应用程序开始播放前必要的缓存。<span class="math inline">\(r(b/s)\)</span>表示视频消耗速率。只要客户端应用程序的缓存未满，服务器会以恒定速率<span class="math inline">\(x(b/s)\)</span>发送数据，则经过<span class="math inline">\(t_{play}=\frac{Q}{x}\)</span>后首次播放。若<span class="math inline">\(x&lt;r\)</span>，客户端在开始播放后应用程序缓存会以<span class="math inline">\(r-x\)</span>的速率消耗，在<span class="math inline">\(t_{pause}=\frac{Q}{r-x}\)</span>后出现停滞，再经过<span class="math inline">\(t_{play}\)</span>后开始播放，一直循环这个过程直至结束。若<span class="math inline">\(x&gt;r\)</span>，客户端在开始播放后应用程序缓存会以<span class="math inline">\(x-r\)</span>的速率增加，经过<span class="math inline">\(t_{full}=\frac{B-Q}{x-r}\)</span>后应用程序缓存达到最大值，播放开始后不会停滞。</p><p>　　现在进一步假设服务器发送数据的速率<span class="math inline">\(x\)</span>不是恒定，初始为0，在<span class="math inline">\(T(s)\)</span>后<span style="background-color:#ff0">线性增长</span>到最大值<span class="math inline">\(H(b/s)\)</span>，然后变为0并再次线性增长，一直循环这个过程。为了保证不会停滞，需要<span class="math inline">\(\overline{x}&gt;r\)</span>，因此<span class="math inline">\(H&gt;2r\)</span>。当<span class="math inline">\(x\)</span>从0开始线性增长时，其加速度<span class="math inline">\(\alpha=\frac{H}{T}\)</span>，期间服务器发送数据<span class="math inline">\(D=\frac{Ht^2}{2T}(b)\)</span>。</p><p>　　若需要保证<span class="math inline">\(Q\)</span>最小，则需要<span class="math inline">\(x\)</span>从0增长到<span class="math inline">\(r\)</span>期间消耗的数据刚好为<span class="math inline">\(Q\)</span>，因此<span class="math inline">\(Q_{min}=\frac{r^2}{2a}=\frac{Tr^2}{2H}\)</span>。</p><p>　　HTTP流经常使用HTTP GET请求报文中的<strong>HTTP字节范围首部</strong>，用来指定客户端当前想要从所需视频中检索的特定字节范围。当需要跳转到视频中未播放的某个时间点时，客户端发送一个新HTTP请求，用字节范围首部指示服务器应该从文件中的对应字节发送，服务器收到后从字节范围首部指示的字节开始发送。当视频跳转到未播放的某个时间点或提前终止时，服务器传输的一些预取但未播放的视频将跳过，导致相关的带宽和服务器资源浪费，无线链路浪费的带宽和服务器资源可能更多。因此，很多流系统进使用了适当的客户端缓存或者使用HTTP请求中的字节范围首部来限制预取的视频。</p><h3 id="ip语音">8.2 IP语音</h3><p>　　VOIP一般默认使用UDP，当用户位于阻止UDP的NAT或防火墙后时才使用TCP。UDP存在丢包的问题，TCP没有丢包的问题，但TCP的重传会增加端到端时延，而且丢包后由于拥塞控制，发送端的传输速率可能降低到低于接收端的消耗速率，从而可能导致缓存饥饿。</p><p>　　实际中，VOIP可以容忍1%到20%的丢包，这取决于语音的编码、传输方式以及接收端隐藏丢包的方式。使用FEC将冗余信息和原始信息一起发送，能够从冗余信息中恢复一些丢失的初始数据。丢包率超过10%~20%则无法采取任何措施来恢复可接受的音频质量。</p><p>　　对于VOIP，小于150ms的时延收听者察觉不到，150ms~400ms的时延可以接受，但不够理想，超过400ms就影响语音交谈的质量。因此，VOIP应用程序的接收端通常忽略时延超过阈值的所有分组。</p><p>　　分组在路由器中经历的变化的排队时延是端到端时延的组成部分之一，因此发送端生成分组到接收端接收到分组的时间可能随着分组的变化而波动，称为<strong>时延抖动</strong>。</p><p>　　时延抖动可以通过<strong>序号</strong>、<strong>时间戳</strong>和<strong>播放时延</strong>来消除。发送端为每个音频块标记其生成时间。类似于流式存储视频的播放时延，接收端的音频块的播放时延必须足够大，以便大多数分组在其预计播放时间之前接收，播放时延可以固定或自适应。</p><h4 id="在接收端消除时延抖动">8.2.1 在接收端消除时延抖动</h4><p>　　使用固定延迟策略时，接收端尝试在块生成后<span class="math inline">\(q(ms)\)</span>播放，若块在<span class="math inline">\(t(ms)\)</span>时被标记时间戳，则接收端在<span class="math inline">\(t+q\)</span>播放该块，若该块在<span class="math inline">\(t+q\)</span>后到达则会被丢弃并视为丢包。若网络时延经常出现较大的变化则<span class="math inline">\(q\)</span>较大更好，若网络时延较小且变化也较小则<span class="math inline">\(q&lt;150ms\)</span>更好。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/packet_loss_for_different_fixed_playout_delays.svg" title="packet_loss_for_different_fixed_playout_delays"><p>　　对于第一个固定播放时延<span class="math inline">\(p-r\)</span>，第4个分组在预计时间未到达则认为丢包。对于第二个固定播放时延<span class="math inline">\(p&#39;-r\)</span>，所有分组都在预计时间内到达。</p><p>　　为了尽可能小的播放时延，可以估计网络时延及其变化并在每次语音的突发期开始时相应地调整播放时延，这会导致发送端的静默期的压缩或拉长。对于第<span class="math inline">\(i\)</span>个分组，<span class="math inline">\(t_i\)</span>表示生成时间，<span class="math inline">\(r_i\)</span>表示接收时间，<span class="math inline">\(p_i\)</span>表示播放时间，<span class="math inline">\(r_i-t_i\)</span>表示网络时延，<span class="math inline">\(d_i\)</span>表示收到该分组时的平均网络时延的估计值。<span class="math inline">\(u\)</span>表示大于0而小于1的常数。 <span class="math display">\[ d_i=(1-u)d_{i-1}+u(r_i-t_i) \]</span> 　　<span class="math inline">\(v_i\)</span>表示估计网络时延与估计的平均网络时延的平均偏差的估计值。 <span class="math display">\[ v_i=(1-u)v_{i-1}+u|r_i-t_i-d_i| \]</span> 　　若分组<span class="math inline">\(i\)</span>是语音突发期首个分组，则<span class="math inline">\(p_i=t_i+d_i+Kv_i\)</span>，<span class="math inline">\(K\)</span>是一个正的常数，<span class="math inline">\(Kv_i\)</span>用于将播放时间设置到足够大，保证语音突发期的分组丢包率较低。突发期内之后的每个分组的播放时间被计算为该突发期内首个分组的播放时间的偏移量。语音突发期的首个分组生成到播放的时间跨度<span class="math inline">\(q_i=p_i-t_i\)</span>，若分组<span class="math inline">\(j\)</span>属于该突发期，它的播放时刻<span class="math inline">\(p_j=t_j+q_i\)</span>。</p><h4 id="丢包恢复">8.2.2 丢包恢复</h4><p>　　VOIP通常使用<span style="background-color:#ff0">FEC</span>和<span style="background-color:#ff0">交织</span>这两种类型的<strong>丢包恢复方案</strong>。</p><p>　　FEC的基本思想是在初始的分组流增加冗余信息。以略微增加传输速率为代价，这些冗余信息可以用于重建一些丢失分组的近似或准确版本。</p><p>　　一种FEC机制是在每<span class="math inline">\(n\)</span>个块后发送一个冗余编码块，冗余块通过异或<span class="math inline">\(n\)</span>个初始块获得，由于接收端在播放前必须收到整个组的分组，因此增加了播放时延。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/piggybacking_lower-quality_redundant_information.svg" title="piggybacking_lower-quality_redundant_information"><p>　　第二种FEC机制是发送一个低质量的音频流作为冗余信息，发送端生成一个标称音频流和与一个相应的低分辨率、低比特率的音频流(标称流可以是<span class="math inline">\(64Kb/s\)</span>的PCM编码，而低质量的流可以是<span class="math inline">\(13Kb/s\)</span>的GSM编码。接收端在播放前只需接收两个分组，因此增加的时延较小。若低质量冗余音频的编码比标称音频小很多则增加的额外传输速率并不大。若需要处理连续丢失，发送端可以每个块附加更多低质量块，但同时也会增加传输带宽和播放时延。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/send_interleaved_audio.svg" title="send_interleaved_audio"><p>　　在交织中，发送端在传输前对音频数据单元重新排序，从而使传输流中原本相邻的单元分开。交织可以减轻丢包的影响从而提高音频流的质量。交织不增加流的带宽，且开销也较低，但增加了时延。</p><p>　　丢包恢复试图为丢失的分组产生一个相似的代替。音频信号表现除大量的短期自相似性，因此差错掩盖方案适用于丢失率较小(低于15%)和分组较小(小于音素)的场景，但损失长度接近音素的长度时，就会失效，因为听者可能听错。</p><h4 id="案例学习skype">8.2.3 案例学习：Skype</h4><p>　　对应音频和视频，Skype客户端使用多种不同的编码方式。Skype默认使用UDP发送音频和视频分组，但控制分组通过TCP发送，UDP被拦截时才使用TCP发送音频和视频分组。Skype客户端通过改变视频质量和FEC开销来使其发送的音频流和视频流适应当前网络环境。</p><p>　　Skype中除了主机间VOIP使用了P2P，用户定位和NAT穿透也使用了P2P。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/skype_peers.svg" title="skype_peers"><p>　　Skype中对等方组织成一个分层的覆盖网络，对等方分为超级对等方和普通对等方。Skype维护一个将用户映射到当前IP地址(和端口)的索引，该索引分布在超级对等方上。当A需要呼叫B时，客户端会搜索该分布式索引以决定B当前的IP地址。</p><p>　　NAT用于阻止外网的主机连接到内网主机，若A和B都有NAT，可以通过超级对等方和<strong>Skype中继</strong>来让A和B建立连接。A向非NAT的超级对等方建立连接，B也向非NAT的超级对等方建立连接。A通知A的超级对等方，A的超级对等方通知B的超级对等方，B的超级对等方再通知B。两个超级对等方选择第三个非NAT的超级对等方作为中继对等方，然后A、B都向中继对等方建立连接。</p><p>　　若<span class="math inline">\(N(N&gt;2)\)</span>个参与者进行音频会议，每个参与者将音频流的副本发送给其他<span class="math inline">\(N-1\)</span>个参与者，因此需将<span class="math inline">\(N(N-1)\)</span>个音频流副本发送到网络中。为了减少带宽消耗，每个参与者向发起者发送其音频流，发起者将这些音频流结合为一个流(基本是将所有的音频流信号加在一起)并发送给其他<span class="math inline">\(N-1\)</span>个参与者，因此需要将<span class="math inline">\(2(N-1)\)</span>个音频流的副本发送到网络。</p><p>　　若<span class="math inline">\(N(N&gt;2)\)</span>个参与者进行视频会议，视频并不能像音频一样结合为一个流且大多数接入链路的上行链路带宽明显低于下行链路带宽(上行链路可能无法支持P2P方式的<span class="math inline">\(N-1\)</span>个视频流)，因此每个参与者的视频流被路由选择到一个服务器集群，该集群将该视频流中继给其他<span class="math inline">\(N-1\)</span>个参与者。</p><h3 id="实时会话应用协议">8.3 实时会话应用协议</h3><h4 id="rtp">8.3.1 RTP</h4><p>　　若应用程序集成了RTP，而不是使用有限载荷类型、序号和时间戳这种专用方案，该应用程序更容易与其他应用程序交互。</p><p>　　RTP不提供任何机制来确保及时交互数据或提供其他QOS保证，也不保证分组交互或防止分组失序。RTP允许每个源(例如，一个麦克风或摄像头等)分配其独立的RTP分组流。很多编码技术将音频和视频捆绑在一个流中，因此也只产生一个RTP流。</p><p>　　RTP分组不仅限于单播应用，也可以经过一对多和多对多的多播树发送。对于多对多的多播会话，所有的发送端和源通常使用相同的多播组来发送RTP流。一起使用的RTP多播流(例如，视频会议中多个发送端发出的音频和视频流)同属于一个<strong>RTP会话</strong>。</p><p>　　对于语音，若语音源使用<span class="math inline">\(64Kb/s\)</span>的PCM编码，每个编码数据的时间长度是20ms，即每个音频块有<span class="math inline">\(160B\)</span>，发送端在每个音频块前添加一个RTP首部，RTP首部通常为<span class="math inline">\(12B\)</span>，音频块和RTP首部一起形成<strong>RTP分组</strong>。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/rtp_header_fields.svg" title="rtp_header_fields"><p>　　RTP首部包括7位<strong>有限载荷类型</strong>、16位<strong>序号</strong>、32位<strong>时间戳</strong>、32<strong>位同步源标识符</strong>以及其他字段。</p><p>　　● 有限载荷类型字段表示音频/视频的编码类型。发送端可以在会话过程中改变编码。</p><table><thead><tr><th>有限载荷类型</th><th>媒体编码格式</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>PCM μ-law</td><td>采样率是8KHz，速率是<span class="math inline">\(64Kb/s\)</span></td></tr><tr><td>1</td><td>1016</td><td>采样率是8KHz，速率是<span class="math inline">\(4.8Kb/s\)</span></td></tr><tr><td>3</td><td>GSM</td><td>采样率是8KHz，速率是<span class="math inline">\(13Kb/s\)</span></td></tr><tr><td>7</td><td>LPC</td><td>采样率是8KHz，速率是<span class="math inline">\(2.4Kb/s\)</span></td></tr><tr><td>9</td><td>G.722</td><td>采样率是16KHz，速率是<span class="math inline">\(48\sim64Kb/s\)</span></td></tr><tr><td>14</td><td>MPEG音频</td><td>采样率是90KHz</td></tr><tr><td>15</td><td>G.728</td><td>采样率是8KHz，速率是<span class="math inline">\(16Kb/s\)</span></td></tr><tr><td>26</td><td>MJPEG</td><td></td></tr><tr><td>31</td><td>H.261</td><td></td></tr><tr><td>32</td><td>MPEG1视频</td><td></td></tr><tr><td>33</td><td>MPEG2视频</td><td></td></tr></tbody></table><p>　　● 发送端每发送一个RTP分组，序号加1，接收端根据序号来检测丢包和恢复分组。</p><p>　　● 时间戳表示RTP分组中第一位的采样时刻。</p><p>　　● SSRC用于标识流的源。在RTP会话中通常每个流的SSRC不同。当新的流生成时分配随机数，若两个流分配的SSRC相同则重新分配SSRC。</p><h4 id="sip">8.3.2 SIP</h4><p>　　SIP是常用于发起和结束呼叫的信令协议，可以用于视频会议和基于文本的会话。实际中，SIP可以作为即时通信应用程序的基本组件。</p><p>　　SIP提供了通过IP网络在呼叫者和被呼叫者间建立呼叫的机制，允许呼叫者通知被呼叫者将要开始呼叫，允许参与者就媒体编码达成一致，也允许参与者接收呼叫。</p><p>　　SIP为呼叫者提供被呼叫者的当前IP地址。用户可能没有固定IP地址，因为它们可能动态分配IP地址或使用多个IP设备。</p><p>　　SIP提供了呼叫管理机制，例如，呼叫期间添加新媒体流、呼叫期间更改编码、呼叫期间邀请新新参与者、呼叫转移和呼叫保持等。</p><p>　　SIP是一个带外协议，发送和接收SIP报文使用了不同于发送和接收媒体数据的套接字。SIP报文是ASCII，与HTTP报文类似。SIP要求所有的报文都有确认，因此能够在UDP或TCP上运行。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/call_establishment_when_ip_address_is_known.svg" title="call_establishment_when_ip_address_is_known"><p>　　当A知道B的IP地址时，A通过UDP向B的5060端口发送一个INVITE报文(类似于HTTP请求报文)，此时一个SIP会话开始。INVITE报文包括B的标识符、A当前IP地址、A希望接收的音频格式以及接收端口。B收到INVITE报文后向A的5060端口发送SIP响应报文(类似于HTTP响应报文)，SIP响应报文包括<code>200 OK</code>、B当前IP地址、B希望接收的音频格式以及接收端口。A收到SIP响应报文后响应SIP ACK报文，然后双方就可以开始发送音频。</p><p>　　若B在收到A的INVITE报文后发现不支持A希望接收的音频编码，则会响应<code>606 NOT Acceptable</code>并在报文中列出支持的编码。A从中选择一个编码并再发送一个INVITE报文。B也能直接发送表示拒绝的代码来拒绝呼叫。</p><p>　　B的SIP地址是<code>B@193.64.210.89</code>，实际上SIP地址可能类似于email地址或电话号码或姓名等。SIP可以包含于Web页面中，当访问者点击SIP地址，访问者设备中SIP应用将启动并向该SIP地址发送INVITE报文。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INVITE sip:B@domain.com SIP/2.0</span><br><span class="line"><span class="attribute">Via</span><span class="punctuation">: </span>SIP/2.0/UDP 167.180.112.24</span><br><span class="line"><span class="attribute">From</span><span class="punctuation">: </span>sip:A@hereway.com</span><br><span class="line"><span class="attribute">To</span><span class="punctuation">: </span>sip:B@domain.com</span><br><span class="line"><span class="attribute">Call-ID</span><span class="punctuation">: </span>a2e3a@pigeon.hereway.com</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/sdp</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>885</span><br><span class="line"> </span><br><span class="line">c=IN IP4 167.180.112.24</span><br><span class="line">m=audio 38060 RTP/AVP 0</span><br></pre></td></tr></table></figure><p>　　<code>INVITE</code>行包含SIP版本。每当SIP报文通过SIP设备(包括产生该报文的设备)时，它附加一个<code>Via</code>首部来指示该设备的IP地址。SIP报文包含一个<code>From</code>首部行和一个<code>To</code>首部行。<code>Call-ID</code>是呼叫的唯一标识符。<code>Content-Type</code>表示SIP报文中内容的格式。在一个换车和换行后就是报文的内容部分。</p><p>　　每个SIP用户都有一个相关联的<strong>SIP注册器</strong>。SIP注册器的功能类似于权威DNS，将SIP地址转换为IP地址。SIP注册器和<strong>SIP代理</strong>通常运行在同一台设备上。每当启动SIP应用程序时都会向SIP注册器发送SIP注册报文来告知它的当前IP地址。</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">REGISTER sip:domain.com SIP/2.0</span><br><span class="line"><span class="attribute">Via</span><span class="punctuation">: </span>SIP/2.0/UDP 193.64.210.89</span><br><span class="line"><span class="attribute">From</span><span class="punctuation">: </span>sip:B@domain.com</span><br><span class="line"><span class="attribute">To</span><span class="punctuation">: </span>sip:B@domain.com</span><br><span class="line"><span class="attribute">Expires</span><span class="punctuation">: </span>3600</span><br></pre></td></tr></table></figure><p>　　<code>Expires</code>表示注册有效期，过期后需要重新向SIP注册器注册。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/sip_session_initiation.svg" title="sip_session_initiation"><p>　　若当前IP地址为217.23.56.89的A需要对当前IP地址为197.87.54.21的B发起VOIP会话，A向hereway的SIP代理发送INVITE报文，该代理在注册器上对domain进行DNS查询并将报文转发给domain的SIP注册器。由于B并没有在domain的SIP注册器上注册，该注册器返回一个重定向到temp的应答。hereway的SIP代理向temp的SIP注册器发送INVITE报文，temp的SIP注册器将INVITE报文转发给B，B收到返回SIP响应，temp的SIP注册器将SIP响应转发给hereway的SIP代理并进一步转发给A。至此A、B可以开始传输音频(还有个SIP ACK)。</p><h3 id="多媒体网络">8.4 多媒体网络</h3><table><colgroup><col style="width:12%"><col style="width:20%"><col style="width:16%"><col style="width:35%"><col style="width:5%"><col style="width:10%"></colgroup><thead><tr><th>方法</th><th>粒度</th><th>保证</th><th>机制</th><th>复杂度</th><th>当前部署状态</th></tr></thead><tbody><tr><td>尽力而为服务</td><td>公平处理所有流量</td><td>无/软</td><td>应用级支持，CDN，覆盖网络，网络级资源供给</td><td>最小</td><td>无处不在</td></tr><tr><td>区分服务</td><td>不同类型的流量处理不同</td><td>无/软</td><td>分组标识，监管，调度</td><td>中等</td><td>部分</td></tr><tr><td>每个连接QOS保证</td><td>每个源到目的地流处理不同</td><td>一旦流被准入，软/硬</td><td>分组标识，监管，调度，呼叫准入和信令</td><td>高</td><td>很少</td></tr></tbody></table><p>　　<strong>带宽供应</strong>指在给定拓扑中能达到给定性能水平的网络链路容量。<strong>网络定制</strong>指设计一个能达到给定水平端到端性能的网络拓扑。</p><p>　　为了预测端到端的应用程序级性能，需要考虑<span style="background-color:#ff0">端到端间的流量需求模型</span>、<span style="background-color:#ff0">明确定义的性能要求</span>和<span style="background-color:#ff0">用于预测给定负载模型的端到端性能模型并求出满足所有用户需求的最低成本带宽</span>。</p><h4 id="提供多种类型的服务">8.4.1 提供多种类型的服务</h4><p>　　在聚合流量(多种流量类型而不是单个连接)中提供了DS。相同类型的流量受到相同的服务，而与它们的所属的端到端连接无关。通过少量的聚合流量而不是大量的单个连接，提供优于尽力而为服务的新型网络机制更简单。</p><p>　　<strong>分组标记</strong>使得路由器区分属于不同类型流量的分组。在流量类型间提供一定程度的<strong>流量隔离</strong>防止某类流量受到另一类异常流量的负面影响，同时尽可能地保证资源利用率最大化。</p><p>　　一种实现流量隔离的方法是<strong>流量监管</strong>，若需要流量类型或流满足某些准则，可以设置监控机制以确保准则的确被遵守。若被监管的应用程序行为异常，则采取某种行动(丢包或延时)以确保其进入网络的流量符合准则。分组分类、分组标记和流量监管都一起在网络边缘或端系统或边界路由器中实现。另一种实现流量隔离的方法是链路级的分组调度机制为每种流量类型明确地分配固定的链路带宽。</p><p>　　流量监管有<span style="background-color:#ff0">平均速率</span>、<span style="background-color:#ff0">峰值速率</span>和<span style="background-color:#ff0">突发大小</span>这3个监管准则。平均速率用于限制较长时间内可以发送网络中的流量，峰值速率用于限制较短时间内可以发送的最大分组数量，突发大小用于限制瞬时发送到网络中分组数量。</p><p>　　漏桶机制是可用于描述流量监管准则的一种抽象，一个漏桶可以容纳<span class="math inline">\(b\)</span>个令牌。可能潜在地添加到桶中的新令牌总是以<span class="math inline">\(r\)</span>个每秒的速率生成。当生成一个新令牌时，若桶中的令牌数量少于<span class="math inline">\(b\)</span>则将新令牌添加到桶中，否则，忽略该令牌。</p><p>　　漏桶机制可以用来监管分组。若分组被进入到网络之前，它必须先从桶中取出一个令牌。若桶为空，则分组必须等待令牌(或丢弃分组)。桶最多可以容纳<span class="math inline">\(b\)</span>个令牌，因此最大突发大小是<span class="math inline">\(b\)</span>个分组。由于令牌生成速率是<span class="math inline">\(r\)</span>，因此长度为<span class="math inline">\(t\)</span>的时间间隔内，可以进入网络的最大分组数为<span class="math inline">\(rt+b\)</span>。此外，令牌的生成速率<span class="math inline">\(r\)</span>用于限制长期内分组进入网络的平均速率。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/leaky_bucket_policer.svg" title="leaky_bucket_policer"><p>　　可以通过串联漏桶来监管流量的峰值速率，第一个漏桶以<span class="math inline">\(r\)</span>个令牌每秒的速率生成令牌，其容量为<span class="math inline">\(b\)</span>个令牌，第二个桶以<span class="math inline">\(p\)</span>个令牌每秒的速率生成令牌，其容量为1个令牌。显然<span class="math inline">\(r&lt;p\)</span>，因为<span class="math inline">\(r&gt;p\)</span>会导致队列溢出并丢失分组。若峰值速率最长持续时间为<span class="math inline">\(t\)</span>，则<span class="math inline">\(rt+b=pt\)</span>，因此<span class="math inline">\(t=\frac{b}{p-r}\)</span>。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/n_multiplexed_leaky_bucket_flows_with_wfq_scheduling.svg" title="n_multiplexed_leaky_bucket_flows_with_wfq_scheduling"><p>　　使用了WFQ调度的路由器的输出链路复用了<span class="math inline">\(n\)</span>条流。流<span class="math inline">\(i\)</span>被容量为<span class="math inline">\(b_i\)</span>和令牌生成速率为<span class="math inline">\(r_i\)</span>的漏桶监管，至少有<span class="math inline">\(\frac{w_iR}{\sum_{j=1}^{n}{w_j}}\)</span>的共享链路带宽。若流1的令牌桶最初是满的，然后<span class="math inline">\(b_1\)</span>个分组突发到达流1的漏桶监管器，因此流1的漏桶中不再有令牌，<span class="math inline">\(b_1\)</span>个分组进入流1的WFQ等待区域。因为这<span class="math inline">\(b_1\)</span>分组以至少<span class="math inline">\(\frac{w_iR}{\sum_{j=1}^{n}{w_j}}\)</span>分组每秒的速率得到服务，其中最后一个分组有最大时延<span class="math inline">\(d_{max}=\frac{b_1\sum^{n}_{j=1}{w_j}}{w_1R}\)</span>。</p><p>　　若在时间<span class="math inline">\(t\)</span>内到达的分组需要排队，此期间内分组流1发送到网络的分组数量和在WFQ队列中排队的分组数量分别表示为<span class="math inline">\(S\)</span>和<span class="math inline">\(Q\)</span>。显然，<span class="math inline">\(S\geqslant\frac{w_iRt}{\sum_{j=1}^{n}{w_j}}\)</span>，<span class="math inline">\(Q=r_1t+b_1-S\)</span>。 <span class="math display">\[ \begin{align} Q&amp;\leqslant r_1t+b_1-\frac{w_iRt}{\sum_{j=1}^{n}{w_j}}\\[3px] Q&amp;\leqslant (r_1-\frac{w_iR}{\sum_{j=1}^{n}{w_j}})t+b_1 \end{align} \]</span> 　　若<span class="math inline">\(r_1&lt;\frac{w_iR}{\sum_{j=1}^{n}{w_j}}\)</span>，则<span class="math inline">\(Q\leqslant b_1\)</span>，即分组流1在WFQ队列中排队的最大分组数是<span class="math inline">\(b_1\)</span>，这些分组得到服务的速率最小值是<span class="math inline">\(\frac{w_iR}{\sum_{j=1}^{n}{w_j}}\)</span>，分组流1中任何在WFQ队列中排队的分组承受的最大时延都是<span class="math inline">\(d_{max}\)</span>。</p><h4 id="ds架构">8.4.2 DS架构</h4><p>　　DS架构由<span style="background-color:#ff0">边缘功能(分组分类和流量调节)</span>和<span style="background-color:#ff0">核心功能(转发)</span>的集合组成。在网络的传入边缘到达的分组将被标记，即将数据报首部中的DS字段设置为某个值。DS架构的一个关键原则是路由器的<strong>每跳行为</strong>仅基于分组(DS)标记，即分组所属的流量类型。因此，DS架构无需为各个"源到目的地对"保持路由器状态，这是DS具有可扩展性的一个关键考虑因素。</p><p>　　PHB导致不同服务类型的流量行为不同，PHB虽然定义了类型间的行为差异，但并未规定特定的机制来实现这些行为。行为的差异必须可以观察，因此可以计量。只需满足外部可观察的行为准则，任何实现机制和任何缓存/带宽分配策略都可以使用。已定义了<strong>加速转发</strong>和<strong>确保转发</strong>这两种PHB。EF PHB规定了一类流量离开路由器的速率必须达到某个已配置的速率，AF PHB将流量分为4类，每个类都确保提供某种最小的带宽和缓存。</p><img src="/2022/09/10/computer-networking-a-top-down-approach-7e-chpt-8/simple_ds_network_example.svg" title="simple_ds_network_example"><p>　　到达边缘路由器的分组首先被分类，分类器根据一个或多个分组首部字段选择分组并引导到对应的标记器。某些情况下，端用户可能同意限制分组发送速率来符合某个声明的<strong>流量配置文件</strong>(该流量配置文件可能包含对峰值速率和突发大小的限制)。只要用户符合流量配置文件，分组就会收到优先级标记并被转发到目的地，否则，超出限制的分组可能被整形(为了保持最大速率而延时)或丢弃。<strong>计量功能</strong>用于将传入的分组流与协商的流量配置文件进行比较并确定是分组否符合规范，而不符合规范时的操作由网络管理员决定。</p><p>　　若不总是有足够的资源提供但需保证呼叫(端到端流)的QOS，则需要进行<strong>呼叫准入控制</strong>，即呼叫声明其QOS所需资源，若网络能保证所需资源则准入，否则进行拦截。保证呼叫的QOS所需资源的唯一方法是显式地为该呼叫分配这些资源，称为<strong>资源预留</strong>。资源预留需要源到目的地路径上的每个路由器都预留足够的资源，这是<strong>呼叫建立</strong>的工作，主要通过<strong>资源预留协议</strong>等信令协议完成。一旦资源被保留，呼叫持续期间都可以按需访问这些资源，而忽略其他呼叫的QOS所需资源。</p></div><footer class="post-footer"><div class="post-nav"><div class="post-nav-item"><a href="/2022/08/24/computer-networking-a-top-down-approach-7e-chpt-7/" rel="prev" title="《计算机网络-自顶向下方法 第7版》第7章 网络安全"><i class="fa fa-angle-left"></i> 《计算机网络-自顶向下方法 第7版》第7章 网络安全</a></div><div class="post-nav-item"><a href="/2022/09/12/computer-networking-a-top-down-approach-7e-appx/" rel="next" title="《计算机网络-自顶向下方法 第7版》附录">《计算机网络-自顶向下方法 第7版》附录 <i class="fa fa-angle-right"></i></a></div></div></footer></article></div></div></main><footer class="footer"><div class="footer-inner"></div></footer><div class="toggle sidebar-toggle" role="button"><span class="toggle-line"></span> <span class="toggle-line"></span> <span class="toggle-line"></span></div><div class="sidebar-dimmer"></div><div class="back-to-top" role="button" aria-label="返回顶部"><i class="fa fa-arrow-up fa-lg"></i> <span>0%</span></div><noscript><div class="noscript-warning">Theme NexT works best with JavaScript enabled</div></noscript><script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script><script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script><script src="/js/third-party/search/local-search.js"></script><script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script><script src="/js/third-party/math/mathjax.js"></script></body></html>